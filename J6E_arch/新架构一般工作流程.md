# 0.前提：
    ## 安装 imobuilder tools
    - 0. v0.0.38 版本及以上，可直接使用指令升级: imobuilder upgrade
    - 1. install imobuilder: 
        python3 -m pip install imobuilder --index-url https://pypi.tuna.tsinghua.edu.cn/simple --extra-index-url   https://nexus.imotion.ai/repository/imotion_pypi/simple --trusted-host nexus.imotion.ai
    - 2. uninstall old version: 
        -2.1 卸载buildconfigparserlib库
        python3 -m pip uninstall buildconfigparserlib buildconfigparserlib-py38-linux buildconfigparserlib-py310-linux -y

        -2.2 卸载imobuildtoolslib库
        python3 -m pip uninstall imobuildtoolslib imobuildtoolslib-py38-linux imobuildtoolslib-py310-linux -y

        -2.3 卸载imobuilder
        python3 -m pip uninstall imobuilder imobuilder-py38-linux imobuilder-py310-linux -y
    - 3. check current version: 
        imobuilder --version
    ## setup zosidl 工具
    - 1. zosidl 下载安装
        python3 -m pip install zosidl --index-url https://pypi.tuna.tsinghua.edu.cn/simple --extra-index-url https://nexus.imotion.ai/repository/imotion_pypi/simple --trusted-host nexus.imotion.ai
    - 2. remove old version: 
        python3 -m pip uninstall zosidl; rm -rf ~/.local/lib/python3.x/site-packages/zosidl/fe/*
    - 3. check current version: 
        zosidl --version

# 1.创建文件夹
    mkdir -p workspace_xxx

# 2. 创建并初始化工作空间
    cd workspace_xxx
    imobuilder create # 创建工作空间

# 3. 配置工作空间
## 3.1-J6E debug
imobuilder configure --build_platform aarch64-linux-j6e-zos # 配置编译平台
imobuilder configure --build_product ZOS/develop    # 配置编译产品
imobuilder configure --build_type debug # 配置编译类型

## 3.1-J6E release
imobuilder configure --build_platform aarch64-linux-j6e-zos
imobuilder configure --build_product ZOS/develop
imobuilder configure --build_type release

## 3.1-22.04 debug
imobuilder configure --build_platform x86_64-linux-ubuntu-22.04.5-base
imobuilder configure --build_product ZOS/develop
imobuilder configure --build_type debug

## 3.1-22.04 release
imobuilder configure --build_platform x86_64-linux-ubuntu-22.04.5-base
imobuilder configure --build_product ZOS/develop
imobuilder configure --build_type release

## 3.2 配置预编译包（该步骤以后可省略）
    reference ./imo_ci.md documentation for more details.

# 4. 下载交叉编译工具链
    imoubilder download --crosstool  # 该命令只会下载当前配置编译平台（platform）的交叉编译工具链，不会下载其他平台的交叉编译工具链。如果配置了多个编译平台，则需要多次执行该命令。
# 5. imoapp(swarch_codegen)配置
## 5.1 三方依赖
    sudo apt-get install curl # 安装curl
## 5.2 版本配置
    config/product/ZOS/develop.yaml 文件中imoapp_bin 字段配置imoapp版本号

# 6. 在zos_msg（独立仓库） 中用idl数据结构定义总线上的数据类型
## 6.1 下载并初始化仓库
    - imobuilder init zos_msg # 初始化仓库
## 6.2 切换开发分支进行开发
    - git checkout feature/zos_msg_xxx   # 切换到对应的分支进行开发
## 6.3 编译idl文件，生成源代码
    - imobuilder build zos_msg -v -r # 会自动完成idl到c++代码的转换，并生成对应的源代码文件放到对应的target 目录下。

# 7.应用层代码对应的 swarch_config（独立仓库） 配置,内分项目文件

## 7.1 下载并初始化仓库
    - imobuilder init swarch_config # 初始化仓库

## 7.2 切换开发分支进行开发
    - git checkout feature/swarch_config_xxx  # 切换到对应的分支进行开发

## 7.3 配置swarch_config
### 7.3.1 SwArcheture 配置
    - events 配置： 定义总线上的事件，包含中间件类型，topic_name, type_name, message_type, value_type等。
       - src/swarch_config/cpj_xxx/SwArcheture/events/xxx.yaml
    - middlewares 配置： 定义中间件
        - src/swarch_config/cpj_xxx/SwArcheture/middlewares/imo_com.yaml
    - swc 配置：描述每个swc的输入输出端口（进程间通信接口）
        - src/swarch_config/cpj_xxx/SwArcheture/swc/xxx.yaml

### 7.3.2 Executable配置
    - executable 配置,定义进程的线程结构图，线程间接口（ddk_channel）,线程间接口与进程间接口的绑定关系等
    - src/swarch_config/Executable/xxx.yaml

# 7.框架代码生成与编译
## 7.1 构建（编译）依赖库
    # 下载并编译的依赖库
    # -r: 依赖库也一起编译
    # -v: 打开cmake verbose选项
    imobuilder build swarch_codegen_demo swarch_config swarch_framework -r -v

    # imo_com 的使用示例可通过如下命令下载代码+编译构建，但目前它是由imoapp生成的代码框架来调用的，一般情况下，应用层是不会直接使用到的。
    imobuilder build imo_com_examples -v 
## 7.2 构建（编译）应用层代码
## 7.2.1 下载并初始化仓库
    - imobuilder init driving_control # 初始化仓库
## 7.2.2 切换开发分支进行开发
    - git checkout feature/driving_control_base_xxx  # 切换到对应的分支进行开发
## 7.2.3 构建（编译）应用层代码
    # 基于swarch_config中的配置生成driving_control代码以及编译成binary
    # -v: 打开cmake verbose选项
    imobuilder build driving_control -v